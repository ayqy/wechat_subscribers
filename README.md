###  简介

一个简单通用的微信公众平台订阅号专用插件。

现在这个版本的插件只支持普通订阅号，任何人只要以个人身份免费注册微信公众平台就可以使用这个插件的全部功能。

这个插件将永久免费:)

<a href="http://www.ayqy.net/cms/wordpress/wp-content/uploads/2017/11/wechat_subscribers.jpg"><img src="http://www.ayqy.net/cms/wordpress/wp-content/uploads/2017/11/wechat_subscribers-169x300.jpg" alt="wechat_subscribers屏幕截图" width="169" height="300" class="alignnone size-medium wp-image-1590"></a>

###  功能特性

- [x] 可设定默认回复为搜索关键字结果
- [x] 可根据类型（Post-type）设定自动回复最新文章、随机文章、搜索结果等
- [x] 可选择某篇文章内容，并将它同步到自动回复中
- [x] 便捷管理多种weixin消息模版，可随时切换，数量不限
- [x] 无需安装任何其他程序，完全使用Wordpress原生支持
- [x] 带有接收消息的历史记录
- [x] 多种消息模式，默认自动回复消息，关键词自动回复消息，weixin订阅自动回复欢迎消息
- [x] 自动检测关键词冲突
- [x] 自由设置纯文本消息、图文消息、最近消息，可随时切换消息类型，排序
- [x] 图片上传管理都使用Wordpress原生图片管理器
- [x] 可以设置默认配图

新增特性：

- [x] 搜索结果**按相关度排序**
- [x] 简单明了的readme（这很重要）
- [ ] 关键字支持类型常量（比如number）
- [ ] 支持命令（比如留言，topN）
- [ ] 趣味性功能（比如语音查询）

##  安装步骤

###  1.下载插件源码

<https://github.com/ayqy/wechat_subscribers>

用默认的master分支即可，下载并解压

P.S.WordPress 4.3.13下亲测可用，其它版本应该也没问题，因为插件没什么依赖，仅用到了很少几个WordPress API（如`get_posts`、`get_results`）

###  2.安装并启用

安装：把解压得到的文件夹丢到ftp的`wordpress/wp-content/plugins`目录下，就算安装完了

启用：进入WordPress后台，从左侧菜单进入插件，找到“微信订阅号管理”，启用

然后需要通过token接入微信公众平台

###  3.配置token

操作步骤：

1.  在后台左侧菜单找到“微信订阅号管理”，进入“插件设置”

2.  填写token，保存更改，会得到一个URL

3.  进入微信公众平台后台，左侧“开发/基本配置 -> 服务器配置/修改配置”填写“URL”和“Token”（用上一步得到的URL和自己填的Token），随机生成EncodingAESKey，选择“明文模式”，提交

4.  （提交成功后会返回上一页）启用服务器配置，面板状态会变成“服务器配置(已启用)”

到这里token就配置好了（双方已经按照既定“协议”建立了信任关系）

###  4.添加自动回复规则

到试玩阶段了，进入WordPress后台，左侧“微信订阅号管理/自定义回复 -> 添加新回复” 

插件提供了3种触发机制（消息匹配机制）：

-  普通：关键字模糊匹配

-  默认：default case，其它的规则都不匹配时就走这个

-  订阅：新增关注时触发

比如添一条测试规则：

    回复标题   test
    关键字     测试,test,t
    触发       普通
    发布       勾选
    类型       纯文本
    内容       hoho

保存并退出，微信进入订阅号发送“测试或test或t”，会立即收到回复“hoho”

回复的消息格式支持：

-  纯文本

-  图文消息：类似于微信公众平台的图文消息，给配图和文章链接

-  最近消息：最新的几篇文章

-  随机消息：随机选取几篇文章

-  搜索关键字：站内搜索结果

最有用的应该是搜索关键字，能把用户想要的博文列表丢过去，当然基础功能也都是可用的

##  问题/需求反馈

如果发现任何bug或者有什么新功能需求，欢迎朝我发送电子邮件。<a href="mailto:nwujiajie@163.com">nwujiajie@163.com</a>

##  常见问题 FAQ

-  1.使用作弊方法来解决一些服务器无法通过token验证的问题

    先按照攻略所说的步骤来，插件中设定好token，然后得到用于接受消息的url，带着这个token和url跑去微信的官方管理后台绑定，要是怎么搞都是无法验证通过，那么请你死马当活马医，把wordpress根目录中的index.php备份了，接着把插件包中的__wechatsucks__.php这文件改名成index.php，复制到wordpress根目录下。

    这时候，再跑去验证试试看，还是用刚才的token和url，不是十分倒霉的话，这时候应该已经验证通过了。把那个假的index.php删掉，恢复之前备份的那个index.php。

    搞这个需要一定的技术常识，不会的话找个懂事儿的去弄。（如果这样都不行，那么就只能换别的插件，或者别的服务器供应商试试看了。）

###  关于

-  Name: WeChat Subscribers Lite 微信公众订阅号插件
-  Contributors: redyyu, HarrySG, AdamLBQ, robin-zhao, ayqy
-  Requires at least: 3.7
-  Tested up to: 4.5.1
-  Stable tag: 4.2.1
-  License: GPLv2 or later
-  License URI: http://www.gnu.org/licenses/gpl-2.0.html

###  详细安装步骤及注意事项

1. 安装后激活插件，左侧的菜单中会出现一微信(weixin/Wechat)一栏。

2. 在Wordpress的设置菜单中多了微信(weixin/Wechat)一项，到这里设置你的Token，这个可以随便写，字母、符号、数字都可以，汉字的不要。插件会替你生成一个URL。URL和Token将在后面用到。

3. 然后去微信(weixin/Wechat)公众平台上绑定你所设置的Token和URL。

4. 回到插件的微信(weixin/Wechat)管理界面，在这里可以添加自定义回复消息，这些自定义消息会根据条件自动回复给向你的微信公众号发消息的订阅者。

5. 添加或者编辑一条新自定义回复消息时，首先设置基本项目。关键字可以多个，但是要用“,”逗号隔开。选择触发方式中除了关键词，还可以选择“默认”那么当没有任何关键字匹配的时候就会使用这条默认发送，而选择“订阅”则这条消息会在新订阅者加入以后触发。选择消息类型可以切换“纯文本”，“图文消息”或是“最近消息”。最后要记得勾选“发布”，这样保存以后系统就会按照设置的规则自动回复用户消息了。

6. 纯文本消息很简单，只要输入你的消息文字即可，也可以插入已有的文章或图片内容，标题会裁剪至80字，正文会裁剪至500字。

7. 编辑图文消息的时候，必要选择一张图片，第一组图文内容的图片尺寸是360x200，之后的为200x200，后面的消息简述则可以选填。

8. 编辑图文的时候也可以直接同步已有的文章或页面，插件会获取用户选择的文章或页面插入到图文编辑的表单中，消息描述会选择文章的摘要，如果没有则提取正文的前140个字符。

9. 上传图片的时候将使用Wordprss原生的图片上传工具。传完以后选一个即可，插件会自动裁剪这两张规格的图片，名称为微信大图和微信小图，可以在插入图片弹出框右下角尺寸选择栏里选择，如果没有显示，确保服务器安装了gd库。

10. 图文消息可以添加最多10组，点击右下角的按钮添加。

11. 单组图文消息可以点击右上角的箭头上下移动，依次来排列消息的顺序。点击每组图文消息右下角的移除按钮可以去掉这组内容。

12. 图文消息类型,可以直接同步已有的文章、页面或其它post_type的内容至图文表单中，只需点击同步按钮，在弹出窗口选择相应条目即可。其中如果同步的对象有特色图像，将会载入特色图像的合适尺寸到图像中，没有则会寻找文章中的第一张图片，都没则会自动插入插件提供的默认图片，用户也可以自行上传或选择媒体库的图片。（注：本地上传的图片会自动裁剪生成适合微信的尺寸，在插入图片弹出框右下角进行尺寸选择即可）也可以点击插入URL按钮，只插入选择对象的链接地址。

13. 最近消息类型，只需要选择自动回复的类型，分类和数量即可。

14. 用户用户发送的消息记录，点击左边消息统计进入页面进行查看管理。

##  Changelog

2016年5月3日 更新到 1.6.6

1. 修正了一些自动回复搜索结果问题

2016年5月3日 更新到 1.6.5

1. 修正了一些JS问题

2016年4月29日 更新到 1.6.4

1. 在设置中增加了自定义默认图片
2. 修改检查冲突关键字的逻辑
3. 修正了一些bug

2015年5月4日 更新到 1.6.2

1. 忘了修正了什么。。。。

2015年5月2日 更新到 1.6.1

1. 修正了 Wordpress 4.2.1 以后列表无法显示的问题

2015年2月25日 更新到 1.60

1. 增加了回复“随机文章”
2. 修正了关键字搜索的设置

2014年9月28日 更新到 1.58

1. 修改了上传的JS接口，支持引入外链图片

2014年8月31日 更新到 1.57

1. 修改了插件使用的权限

2014年8月3日 更新到 1.56

1. 修改了返回消息的字数限制

2014年8月3日 更新到 1.55

1. 修正了同步文章时发生的AJAX错误
2. 增加了自动回复关键字搜索结果

2014年8月2日 更新到 1.53

1. 修正了一些版本PHP环境无法激活的问题

2014年8月2日 更新到 1.52

1. 修正了一些乌龙BUG

2014年8月2日 更新到 1.51

1. 修改了个吧命名错误。
2. 增加了一个用来解决一些服务器无法验证通过token的作弊文件

2014年7月30日 更新到 1.50

1. 增加了编辑自定义消息的时候选择已有的各种类型文章“同步”或者“插入”到微信回复中
2. 增加了最近消息回复回复类型
3. 增加了图片上传时自动裁剪至适合微信显示的尺寸
4. 增加了用户访问统计管理

2014年3月14日 更新到 1.04

1. 修正了微信接口参数排序修改导致了无法响应的问题

2014年3月12日 更新到 1.03

1. 修正了 “请求URL超时” 的问题。
2. 增加了Token最大字符数量限制。

2014年3月9日 更新到 1.02

1. 修正了一些文本错误。
2. 修正当输入图文消息后，中文转换编码错误的问题

2014年3月5日 更新到 1.01

1. 修正了设置TOKEN时候可能误输入奇葩字符导致接口URL错误的问题。
